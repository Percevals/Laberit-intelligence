<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Reporte Semanal - Immunity Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a2332;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .form-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .form-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .incident-container {
            border: 1px dashed #dee2e6;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
            background: white;
        }
        
        .incident-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .incident-number {
            font-weight: 600;
            color: #3498db;
        }
        
        .remove-incident {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-incident:hover {
            background: #c0392b;
        }
        
        .add-button {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .add-button:hover {
            background: #27ae60;
        }
        
        .generate-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            display: block;
            margin: 40px auto;
            transition: all 0.3s;
        }
        
        .generate-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .output-section {
            display: none;
            margin-top: 40px;
        }
        
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .download-button {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
        }
        
        .download-button:hover {
            background: #27ae60;
        }
        
        .preview-container {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            height: 600px;
            overflow: hidden;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .help-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .section-divider {
            border-top: 2px solid #e9ecef;
            margin: 30px 0;
        }
        
        .metric-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .inline-inputs {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
        }
        
        .dark-web-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .country-input {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        
        .country-name {
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
        }
        
        /* Loading animation */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Generador de Reporte Semanal</h1>
        <p class="subtitle">Complete los datos de la semana para generar el Dashboard de Inmunidad Digital</p>
        
        <form id="weeklyDataForm">
            <!-- Secci√≥n de Fecha -->
            <div class="form-section">
                <h2>üìÖ Informaci√≥n Temporal</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="fechaInicio">Fecha de Inicio de Semana</label>
                        <input type="date" id="fechaInicio" required>
                    </div>
                    <div class="form-group">
                        <label for="fechaFin">Fecha de Fin de Semana</label>
                        <input type="date" id="fechaFin" required>
                    </div>
                    <div class="form-group">
                        <label for="numeroSemana">N√∫mero de Semana</label>
                        <input type="number" id="numeroSemana" min="1" max="52" required>
                        <span class="help-text">Semana del a√±o (1-52)</span>
                    </div>
                </div>
            </div>
            
            <!-- Secci√≥n de M√©tricas Principales -->
            <div class="form-section">
                <h2>üìä M√©tricas Principales</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="inmunidadPromedio">Inmunidad Promedio Regional</label>
                        <input type="number" id="inmunidadPromedio" step="0.1" min="0" max="10" value="3.8" required>
                    </div>
                    <div class="form-group">
                        <label for="ataquesSemana">Ataques/Semana LATAM</label>
                        <input type="number" id="ataquesSemana" min="0" value="2569" required>
                    </div>
                    <div class="form-group">
                        <label for="porcentajePhishing">% Phishing en Brasil</label>
                        <input type="number" id="porcentajePhishing" min="0" max="100" value="51" required>
                    </div>
                    <div class="form-group">
                        <label for="porcentajeMasAtaques">% M√°s Ataques que Global</label>
                        <input type="number" id="porcentajeMasAtaques" min="0" max="100" value="40" required>
                    </div>
                </div>
            </div>
            
            <!-- Secci√≥n de Incidentes -->
            <div class="form-section">
                <h2>üö® Incidentes Principales de la Semana</h2>
                <div id="incidentsContainer">
                    <!-- Los incidentes se agregar√°n din√°micamente aqu√≠ -->
                </div>
                <button type="button" class="add-button" onclick="addIncident()">‚ûï Agregar Incidente</button>
            </div>
            
            <!-- Secci√≥n Dark Web -->
            <div class="form-section">
                <h2>üåê Inteligencia Dark Web</h2>
                <h3 style="font-size: 16px; margin: 20px 0 10px 0;">Menciones por Pa√≠s (%)</h3>
                <div class="dark-web-grid">
                    <div class="country-input">
                        <div class="country-name">üáßüá∑ Brasil</div>
                        <input type="number" id="dwBrasil" min="0" max="100" value="31" placeholder="%">
                    </div>
                    <div class="country-input">
                        <div class="country-name">üá≤üáΩ M√©xico</div>
                        <input type="number" id="dwMexico" min="0" max="100" value="18" placeholder="%">
                    </div>
                    <div class="country-input">
                        <div class="country-name">üá¶üá∑ Argentina</div>
                        <input type="number" id="dwArgentina" min="0" max="100" value="15" placeholder="%">
                    </div>
                    <div class="country-input">
                        <div class="country-name">üá®üá¥ Colombia</div>
                        <input type="number" id="dwColombia" min="0" max="100" value="12" placeholder="%">
                    </div>
                </div>
                
                <h3 style="font-size: 16px; margin: 20px 0 10px 0;">Hallazgos Principales</h3>
                <div class="form-group">
                    <label for="darkWebHallazgos">Descripci√≥n de hallazgos en Dark Web</label>
                    <textarea id="darkWebHallazgos" rows="4" placeholder="Ej: Aumento de venta de accesos bancarios brasile√±os, nuevos foros especializados en LATAM...">Se detect√≥ un aumento del 45% en la venta de credenciales corporativas brasile√±as. Precio promedio: $2,500 USD por acceso RDP. Los foros de Telegram muestran coordinaci√≥n activa de campa√±as de phishing dirigidas al sector financiero.</textarea>
                </div>
            </div>
            
            <!-- Secci√≥n de Cliente -->
            <div class="form-section">
                <h2>üè¢ Personalizaci√≥n del Cliente</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="clienteNombre">Nombre del Cliente</label>
                        <input type="text" id="clienteNombre" placeholder="Ej: Banco XYZ" value="Su Organizaci√≥n">
                    </div>
                    <div class="form-group">
                        <label for="clienteScore">Score de Inmunidad del Cliente</label>
                        <input type="number" id="clienteScore" step="0.1" min="0" max="10" placeholder="Ej: 5.2">
                    </div>
                    <div class="form-group">
                        <label for="clienteSector">Sector del Cliente</label>
                        <select id="clienteSector">
                            <option value="Financiero">Financiero</option>
                            <option value="Gobierno">Gobierno</option>
                            <option value="Salud">Salud</option>
                            <option value="Retail">Retail</option>
                            <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                            <option value="Manufactura">Manufactura</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="clientePercentil">Percentil en su Sector</label>
                        <input type="number" id="clientePercentil" min="1" max="100" placeholder="Ej: 75">
                    </div>
                </div>
                <div class="form-group">
                    <label for="clienteMensaje">Mensaje Personalizado</label>
                    <textarea id="clienteMensaje" rows="3" placeholder="Mensaje espec√≠fico para el cliente...">Su organizaci√≥n muestra mejoras consistentes en la implementaci√≥n de controles de seguridad. Sin embargo, la exposici√≥n a ataques de supply chain requiere atenci√≥n inmediata.</textarea>
                </div>
            </div>
            
            <!-- Secci√≥n de Amenazas Activas -->
            <div class="form-section">
                <h2>‚ö° Grupos de Amenazas Activos</h2>
                <div id="threatActorsContainer">
                    <!-- Se agregar√°n din√°micamente -->
                </div>
                <button type="button" class="add-button" onclick="addThreatActor()">‚ûï Agregar Grupo APT</button>
            </div>
            
            <!-- Patr√≥n Confirmado -->
            <div class="form-section">
                <h2>üí° Insight Principal de la Semana</h2>
                <div class="form-group">
                    <label for="patronConfirmado">Patr√≥n o Tendencia Confirmada</label>
                    <textarea id="patronConfirmado" rows="3" required>Modelos de negocio d√©biles = blancos f√°ciles. La tecnolog√≠a no compensa una arquitectura empresarial vulnerable.</textarea>
                </div>
            </div>
            
            <button type="button" class="generate-button" onclick="generateReport()">
                üöÄ Generar Dashboard
            </button>
        </form>
        
        <div class="loading" id="loadingSection">
            <div class="loading-spinner"></div>
            <p style="margin-top: 15px;">Generando dashboard...</p>
        </div>
        
        <!-- Secci√≥n de Output -->
        <div class="output-section" id="outputSection">
            <div class="output-header">
                <h2>‚úÖ Dashboard Generado</h2>
                <button class="download-button" onclick="downloadReport()">üíæ Descargar HTML</button>
            </div>
            <div class="preview-container">
                <iframe id="previewFrame"></iframe>
            </div>
        </div>
    </div>
    
    <script>
        // Template del dashboard (simplificado para el ejemplo)
        const dashboardTemplate = `<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Dashboard de Inmunidad Digital: LATAM & Espa√±a | L√£berit</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
background-color: #091F2C;
color: #ffffff;
line-height: 1.6;
padding-bottom: 60px;
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

/* Client Widget Section */
.client-widget {
background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(26, 43, 61, 0.6));
padding: 30px;
border-radius: 12px;
margin-bottom: 30px;
border: 2px solid rgba(52, 152, 219, 0.3);
text-align: center;
}

.client-widget h2 {
font-size: 28px;
color: #3498db;
margin-bottom: 15px;
}

.client-widget-content {
font-size: 18px;
line-height: 1.8;
}

/* Executive Summary Card */
.executive-summary {
background: linear-gradient(135deg, rgba(180, 181, 223, 0.2), rgba(26, 43, 61, 0.6));
padding: 30px;
border-radius: 12px;
margin-bottom: 30px;
border: 2px solid rgba(180, 181, 223, 0.3);
}

.executive-summary h2 {
font-size: 24px;
color: #B4B5DF;
margin-bottom: 20px;
display: flex;
align-items: center;
gap: 10px;
}

.summary-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
}

.summary-item {
text-align: center;
}

.summary-number {
font-size: 42px;
font-weight: 700;
margin-bottom: 5px;
}

.summary-label {
font-size: 14px;
color: #A6BBC8;
}

.summary-action {
background: rgba(180, 181, 223, 0.2);
padding: 15px 20px;
border-radius: 8px;
margin-top: 20px;
font-size: 16px;
text-align: center;
}

/* Navigation Path */
.nav-path {
display: flex;
justify-content: center;
align-items: center;
gap: 30px;
margin-bottom: 30px;
padding: 20px;
background: rgba(26, 43, 61, 0.3);
border-radius: 8px;
}

.nav-step {
display: flex;
align-items: center;
gap: 10px;
color: #A6BBC8;
font-size: 16px;
}

.nav-step.active {
color: #B4B5DF;
font-weight: 600;
}

.nav-number {
width: 30px;
height: 30px;
background: rgba(180, 181, 223, 0.3);
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-weight: 600;
}

.nav-step.active .nav-number {
background: #B4B5DF;
color: #091F2C;
}

/* Header */
.header {
text-align: center;
padding: 30px;
background: rgba(26, 43, 61, 0.5);
border-radius: 12px;
margin-bottom: 30px;
}

.header h1 {
font-size: 32px;
font-weight: 400;
margin-bottom: 10px;
}

.header-date {
color: #A6BBC8;
font-size: 15px;
}

/* Business Model Box */
.business-model-box {
background: rgba(180, 181, 223, 0.1);
padding: 20px;
border-radius: 8px;
margin: 20px 0;
border: 1px dashed rgba(180, 181, 223, 0.3);
}

.business-model-box h3 {
font-size: 16px;
color: #B4B5DF;
margin-bottom: 15px;
display: flex;
align-items: center;
gap: 8px;
}

.model-equation {
font-size: 16px;
text-align: center;
margin: 15px 0;
padding: 15px;
background: rgba(26, 43, 61, 0.5);
border-radius: 6px;
font-weight: 600;
}

.model-components {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-top: 15px;
}

.component-item {
text-align: center;
padding: 10px;
}

.component-value {
font-size: 24px;
font-weight: 700;
color: #B4B5DF;
}

.component-label {
font-size: 12px;
color: #A6BBC8;
margin-top: 5px;
}

/* Key Metrics */
.metrics-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 20px;
margin-bottom: 30px;
}

.metric-card {
background: rgba(26, 43, 61, 0.5);
padding: 25px;
border-radius: 8px;
text-align: center;
border: 1px solid rgba(180, 181, 223, 0.2);
cursor: pointer;
transition: all 0.2s;
position: relative;
}

.metric-card:hover {
transform: translateY(-2px);
border-color: rgba(180, 181, 223, 0.4);
}

.metric-icon {
font-size: 28px;
margin-bottom: 10px;
}

.metric-number {
font-size: 36px;
font-weight: 600;
color: #B4B5DF;
display: block;
margin-bottom: 5px;
}

.metric-label {
font-size: 13px;
color: #A6BBC8;
text-transform: uppercase;
}

.metric-context {
font-size: 12px;
color: #7A99AC;
margin-top: 8px;
font-style: italic;
}

/* Traffic Light Indicator */
.traffic-light {
position: absolute;
top: 10px;
right: 10px;
width: 20px;
height: 20px;
border-radius: 50%;
}

.traffic-light.red { background: #C10016; }
.traffic-light.yellow { background: #FFB84D; }
.traffic-light.green { background: #4CAF50; }

/* Alert Box */
.alert-box {
background: linear-gradient(135deg, rgba(180, 181, 223, 0.3), rgba(26, 43, 61, 0.8));
padding: 25px;
border-radius: 8px;
margin-bottom: 25px;
border-left: 4px solid #B4B5DF;
}

.alert-title {
font-size: 18px;
font-weight: 600;
margin-bottom: 10px;
color: #B4B5DF;
}

.alert-content {
font-size: 16px;
line-height: 1.6;
}

.alert-source {
font-size: 12px;
color: #7A99AC;
margin-top: 10px;
font-style: italic;
}

/* Dark Web Intel Section */
.dark-web-section {
background: linear-gradient(135deg, rgba(193, 0, 22, 0.2), rgba(26, 43, 61, 0.6));
padding: 30px;
border-radius: 12px;
margin: 30px 0;
border: 2px solid rgba(193, 0, 22, 0.3);
}

.dark-web-section h2 {
font-size: 24px;
color: #C10016;
margin-bottom: 20px;
display: flex;
align-items: center;
gap: 10px;
}

.dark-web-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 20px;
}

.dark-web-card {
background: rgba(26, 43, 61, 0.5);
padding: 20px;
border-radius: 8px;
border: 1px solid rgba(193, 0, 22, 0.2);
}

.dark-web-card h3 {
font-size: 18px;
margin-bottom: 15px;
color: #B4B5DF;
}

.dark-web-content {
font-size: 14px;
line-height: 1.6;
}

/* Section Title */
.section-title {
font-size: 24px;
text-align: center;
margin: 40px 0 20px 0;
color: #B4B5DF;
}

.section-subtitle {
text-align: center;
font-size: 13px;
color: #A6BBC8;
margin-bottom: 25px;
}

/* Threat Grid */
.threat-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
gap: 20px;
margin-bottom: 40px;
}

.threat-card {
background: rgba(26, 43, 61, 0.5);
padding: 20px;
border-radius: 8px;
border: 1px solid rgba(180, 181, 223, 0.2);
}

.threat-header {
display: flex;
align-items: center;
gap: 12px;
margin-bottom: 15px;
padding-bottom: 15px;
border-bottom: 1px solid rgba(180, 181, 223, 0.1);
}

.threat-icon {
width: 36px;
height: 36px;
border-radius: 6px;
display: flex;
align-items: center;
justify-content: center;
font-size: 18px;
font-weight: bold;
}

.icon-actors { background: rgba(193, 0, 22, 0.2); color: #C10016; }
.icon-threats { background: rgba(79, 117, 139, 0.2); color: #4F758B; }
.icon-vectors { background: rgba(122, 153, 172, 0.2); color: #7A99AC; }

.threat-title {
font-size: 18px;
font-weight: 500;
}

.threat-subtitle {
font-size: 12px;
color: #A6BBC8;
}

.threat-list {
list-style: none;
}

.threat-list li {
background: rgba(255, 255, 255, 0.03);
padding: 12px;
margin-bottom: 8px;
border-radius: 6px;
cursor: pointer;
transition: all 0.2s;
border-left: 3px solid transparent;
}

.threat-list li:hover {
background: rgba(255, 255, 255, 0.06);
transform: translateX(3px);
}

.threat-actors li:hover { border-left-color: #C10016; }
.threat-threats li:hover { border-left-color: #4F758B; }
.threat-vectors li:hover { border-left-color: #7A99AC; }

.threat-name {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 4px;
}

.threat-technical {
font-size: 12px;
color: #7A99AC;
}

.threat-value {
font-weight: 600;
color: #B4B5DF;
}

.threat-source {
font-size: 11px;
color: #7A99AC;
}

/* Footer */
.footer {
text-align: center;
padding: 40px 20px;
color: #A6BBC8;
}

.footer-quote {
font-size: 18px;
font-style: italic;
color: #B4B5DF;
margin-bottom: 8px;
}

/* Ticker */
.ticker {
position: fixed;
bottom: 0;
left: 0;
right: 0;
background: rgba(193, 0, 22, 0.95);
color: white;
padding: 12px 20px;
display: flex;
justify-content: space-between;
align-items: center;
font-size: 14px;
z-index: 999;
}

.ticker-content {
display: flex;
align-items: center;
gap: 20px;
}

.ticker-source {
font-size: 12px;
opacity: 0.8;
}

.ticker-action {
cursor: pointer;
text-decoration: underline;
}
</style>
</head>
<body>
<div class="container">
<!-- Client Widget Section -->
{{CLIENT_WIDGET}}

<!-- Executive Summary Card -->
<div class="executive-summary">
<h2>üéØ Resumen Ejecutivo - Su Empresa en 30 Segundos</h2>
<div class="summary-grid">
<div class="summary-item">
<div class="summary-number" style="color: #FFB84D;">{{INMUNIDAD_PROMEDIO}}</div>
<div class="summary-label">Inmunidad Promedio Regional</div>
</div>
<div class="summary-item">
<div class="summary-number" style="color: #4CAF50;">{{ATAQUES_SEMANA}}</div>
<div class="summary-label">Ataques/Semana LATAM</div>
</div>
<div class="summary-item">
<div class="summary-number" style="color: #C10016;">{{PORCENTAJE_PHISHING}}%</div>
<div class="summary-label">Phishing en Brasil</div>
</div>
</div>
<div class="summary-action">
<strong>La nueva realidad:</strong> Su modelo de negocio ES su primera l√≠nea de defensa. La fortaleza no est√° en la tecnolog√≠a, sino en la resiliencia de su arquitectura empresarial.
</div>
</div>

<!-- Navigation Guide -->
<div class="nav-path">
<div class="nav-step active">
<div class="nav-number">1</div>
<span>Su Modelo de Negocio</span>
</div>
<div class="nav-step">
<div class="nav-number">2</div>
<span>Su Fortaleza Real</span>
</div>
<div class="nav-step">
<div class="nav-number">3</div>
<span>Su Inmunidad Digital</span>
</div>
</div>

<!-- Header -->
<div class="header">
<h1>Dashboard de Inmunidad Digital: LATAM & Espa√±a</h1>
<div class="header-date">An√°lisis Semanal: {{FECHA}} | Framework 3.0 con Business Fortress</div>
</div>

<!-- Business Model Introduction -->
<div class="business-model-box">
<h3>üí° Nueva F√≥rmula de Inmunidad 3.0: Integrando Fortaleza del Modelo de Negocio</h3>
<div class="model-equation">
INMUNIDAD = (Efectividad de Protecci√≥n √ó Fortaleza del Negocio √ó Agilidad de Respuesta) / 20
</div>
<div class="model-components">
<div class="component-item">
<div class="component-value">üõ°Ô∏è</div>
<div class="component-label">Efectividad de Protecci√≥n<br>=<br>Preparaci√≥n √ó Desempe√±o</div>
</div>
<div class="component-item">
<div class="component-value">üè∞</div>
<div class="component-label">Fortaleza del Negocio<br>=<br>Resiliencia √ó (1 - Exposici√≥n/2)</div>
</div>
<div class="component-item">
<div class="component-value">‚ö°</div>
<div class="component-label">Agilidad de Respuesta<br>=<br>Velocidad √ó Efectividad</div>
</div>
</div>
</div>

<!-- Recent Incidents Alert -->
<div class="alert-box">
<div class="alert-title">INCIDENTES CR√çTICOS | ESTA SEMANA EN LATAM</div>
<div class="alert-content">
{{INCIDENTES}}
<strong style="color: #B4B5DF;">{{PATRON_CONFIRMADO}}</strong>
</div>
<div class="alert-source">
Fuentes: Reuters, Bitdefender, CyberSecurityDive - An√°lisis Framework 3.0
</div>
</div>

<!-- Key Metrics -->
<h2 class="section-title">M√©tricas de Inmunidad Digital v3.0</h2>
<p class="section-subtitle">Nuevo an√°lisis incorporando Fortaleza del Modelo de Negocio</p>

<div class="metrics-grid">
<div class="metric-card">
<div class="traffic-light yellow"></div>
<div class="metric-icon">üõ°Ô∏è</div>
<span class="metric-number">{{INMUNIDAD_SCORE}}/10</span>
<span class="metric-label">Inmunidad Digital v3.0</span>
<span class="metric-context">10% menos que v2.0</span>
</div>
<div class="metric-card">
<div class="traffic-light red"></div>
<div class="metric-icon">üéØ</div>
<span class="metric-number">{{PORCENTAJE_MAS_ATAQUES}}%</span>
<span class="metric-label">M√°s Ataques que Global</span>
<span class="metric-context">{{ATAQUES_SEMANA}} vs 1,848/semana</span>
</div>
<div class="metric-card">
<div class="traffic-light red"></div>
<div class="metric-icon">üèõÔ∏è</div>
<span class="metric-number">1.5</span>
<span class="metric-label">Inmunidad Gobierno</span>
<span class="metric-context">Modelo m√°s vulnerable</span>
</div>
<div class="metric-card">
<div class="traffic-light red"></div>
<div class="metric-icon">üìß</div>
<span class="metric-number">64%</span>
<span class="metric-label">Ataques via Web/Email</span>
<span class="metric-context">Vector principal LATAM</span>
</div>
</div>

<!-- Dark Web Intelligence Section -->
{{DARK_WEB_INTEL}}

<!-- Footer -->
<div class="footer">
<div class="footer-quote">"Su modelo de negocio define su inmunidad digital m√°s que cualquier tecnolog√≠a"</div>
<div>Business Fortress: La nueva dimensi√≥n de la ciberseguridad ejecutiva | L√£berit</div>
</div>
</div>

<!-- Ticker -->
<div class="ticker" id="ticker">
<div class="ticker-content">
<strong>ALERTA CONTINUA:</strong>
<span id="tickerVictim">Brasil lidera con {{PORCENTAJE_PHISHING}}% ataques phishing regionales</span>
</div>
<div>
<span class="ticker-source" id="tickerSource">Fuente: SocRadar</span> |
<span class="ticker-action">Ver an√°lisis</span>
</div>
</div>
</body>
</html>`;
        
        let incidentCount = 0;
        let threatActorCount = 0;
        
        // Funci√≥n para agregar incidente
        function addIncident() {
            incidentCount++;
            const container = document.getElementById('incidentsContainer');
            const incidentDiv = document.createElement('div');
            incidentDiv.className = 'incident-container';
            incidentDiv.id = `incident-${incidentCount}`;
            
            incidentDiv.innerHTML = `
                <div class="incident-header">
                    <span class="incident-number">Incidente #${incidentCount}</span>
                    <button type="button" class="remove-incident" onclick="removeIncident(${incidentCount})">Eliminar</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="incPais${incidentCount}">Pa√≠s</label>
                        <select id="incPais${incidentCount}" required>
                            <option value="Brasil">Brasil</option>
                            <option value="M√©xico">M√©xico</option>
                            <option value="Argentina">Argentina</option>
                            <option value="Colombia">Colombia</option>
                            <option value="Chile">Chile</option>
                            <option value="Per√∫">Per√∫</option>
                            <option value="Global">Global</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="incOrg${incidentCount}">Organizaci√≥n</label>
                        <input type="text" id="incOrg${incidentCount}" placeholder="Ej: Banco XYZ" required>
                    </div>
                    <div class="form-group">
                        <label for="incFecha${incidentCount}">Fecha del Incidente</label>
                        <input type="text" id="incFecha${incidentCount}" placeholder="Ej: 24 junio" required>
                    </div>
                    <div class="form-group">
                        <label for="incTipo${incidentCount}">Tipo de Incidente</label>
                        <select id="incTipo${incidentCount}" required>
                            <option value="Ransomware">Ransomware</option>
                            <option value="Exposici√≥n de Datos">Exposici√≥n de Datos</option>
                            <option value="Phishing">Phishing</option>
                            <option value="Supply Chain Attack">Supply Chain Attack</option>
                            <option value="DDoS">DDoS</option>
                            <option value="Insider Threat">Insider Threat</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="incImpacto${incidentCount}">Impacto</label>
                    <input type="text" id="incImpacto${incidentCount}" placeholder="Ej: 5 millones de clientes afectados" required>
                </div>
                <div class="form-group">
                    <label for="incFortaleza${incidentCount}">Fortaleza Estimada de la V√≠ctima</label>
                    <input type="number" id="incFortaleza${incidentCount}" step="0.1" min="0" max="10" placeholder="Ej: 2.5" required>
                </div>
            `;
            
            container.appendChild(incidentDiv);
        }
        
        // Funci√≥n para eliminar incidente
        function removeIncident(id) {
            const element = document.getElementById(`incident-${id}`);
            element.remove();
        }
        
        // Funci√≥n para agregar grupo APT
        function addThreatActor() {
            threatActorCount++;
            const container = document.getElementById('threatActorsContainer');
            const threatDiv = document.createElement('div');
            threatDiv.className = 'incident-container';
            threatDiv.id = `threat-${threatActorCount}`;
            
            threatDiv.innerHTML = `
                <div class="incident-header">
                    <span class="incident-number">Grupo APT #${threatActorCount}</span>
                    <button type="button" class="remove-incident" onclick="removeThreat(${threatActorCount})">Eliminar</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="threatName${threatActorCount}">Nombre del Grupo</label>
                        <input type="text" id="threatName${threatActorCount}" placeholder="Ej: Scattered Spider" required>
                    </div>
                    <div class="form-group">
                        <label for="threatActivity${threatActorCount}">Nivel de Actividad</label>
                        <select id="threatActivity${threatActorCount}" required>
                            <option value="MUY ALTA">MUY ALTA</option>
                            <option value="ALTA">ALTA</option>
                            <option value="MEDIA">MEDIA</option>
                            <option value="BAJA">BAJA</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="threatSectors${threatActorCount}">Sectores Objetivo</label>
                        <input type="text" id="threatSectors${threatActorCount}" placeholder="Ej: Aviaci√≥n, Gaming" required>
                    </div>
                    <div class="form-group">
                        <label for="threatImmunity${threatActorCount}">Inmunidad Objetivo</label>
                        <input type="text" id="threatImmunity${threatActorCount}" placeholder="Ej: < 4" required>
                    </div>
                </div>
            `;
            
            container.appendChild(threatDiv);
        }
        
        // Funci√≥n para eliminar grupo APT
        function removeThreat(id) {
            const element = document.getElementById(`threat-${id}`);
            element.remove();
        }
        
        // Funci√≥n para formatear fecha
        function formatDateRange(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const months = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 
                           'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
            
            return `${start.getDate()}-${end.getDate()} de ${months[end.getMonth()]} ${end.getFullYear()}`;
        }
        
        // Funci√≥n principal para generar el reporte
        function generateReport() {
            // Mostrar loading
            document.getElementById('loadingSection').style.display = 'block';
            
            // Recopilar datos del formulario
            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;
            const fechaFormateada = formatDateRange(fechaInicio, fechaFin);
            
            // Recopilar incidentes
            let incidentesHTML = '';
            const incidentElements = document.querySelectorAll('[id^="incident-"]');
            incidentElements.forEach((element, index) => {
                const num = element.id.split('-')[1];
                const pais = document.getElementById(`incPais${num}`).value;
                const org = document.getElementById(`incOrg${num}`).value;
                const fecha = document.getElementById(`incFecha${num}`).value;
                const impacto = document.getElementById(`incImpacto${num}`).value;
                const fortaleza = document.getElementById(`incFortaleza${num}`).value;
                
                incidentesHTML += `<strong>${pais} - ${org} (${fecha}):</strong> ${impacto}. Fortaleza estimada: ${fortaleza}/5.<br>`;
            });
            
            // Crear widget del cliente
            const clienteNombre = document.getElementById('clienteNombre').value;
            const clienteScore = document.getElementById('clienteScore').value;
            const clientePercentil = document.getElementById('clientePercentil').value;
            const clienteMensaje = document.getElementById('clienteMensaje').value;
            
            const clientWidget = clienteScore ? `
                <div class="client-widget">
                    <h2>Panel Ejecutivo - ${clienteNombre}</h2>
                    <div class="client-widget-content">
                        <p><strong>Su Score de Inmunidad: ${clienteScore}/10</strong> (Promedio sector: 3.8)</p>
                        <p>Est√° en el percentil ${clientePercentil} de su sector</p>
                        <p style="margin-top: 15px; font-size: 16px;">${clienteMensaje}</p>
                    </div>
                </div>
            ` : '';
            
            // Crear secci√≥n Dark Web
            const dwBrasil = document.getElementById('dwBrasil').value;
            const dwMexico = document.getElementById('dwMexico').value;
            const dwArgentina = document.getElementById('dwArgentina').value;
            const dwColombia = document.getElementById('dwColombia').value;
            const darkWebHallazgos = document.getElementById('darkWebHallazgos').value;
            
            const darkWebSection = `
                <div class="dark-web-section">
                    <h2>üåê Inteligencia Dark Web - Semana ${fechaFormateada}</h2>
                    <div class="dark-web-grid">
                        <div class="dark-web-card">
                            <h3>Menciones por Pa√≠s</h3>
                            <div class="dark-web-content">
                                <p>üáßüá∑ Brasil: ${dwBrasil}%</p>
                                <p>üá≤üáΩ M√©xico: ${dwMexico}%</p>
                                <p>üá¶üá∑ Argentina: ${dwArgentina}%</p>
                                <p>üá®üá¥ Colombia: ${dwColombia}%</p>
                            </div>
                        </div>
                        <div class="dark-web-card">
                            <h3>Hallazgos Principales</h3>
                            <div class="dark-web-content">
                                <p>${darkWebHallazgos}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Reemplazar variables en la plantilla
            let finalHTML = dashboardTemplate
                .replace(/{{CLIENT_WIDGET}}/g, clientWidget)
                .replace(/{{FECHA}}/g, fechaFormateada)
                .replace(/{{INMUNIDAD_PROMEDIO}}/g, document.getElementById('inmunidadPromedio').value)
                .replace(/{{ATAQUES_SEMANA}}/g, document.getElementById('ataquesSemana').value)
                .replace(/{{PORCENTAJE_PHISHING}}/g, document.getElementById('porcentajePhishing').value)
                .replace(/{{PORCENTAJE_MAS_ATAQUES}}/g, document.getElementById('porcentajeMasAtaques').value)
                .replace(/{{INMUNIDAD_SCORE}}/g, document.getElementById('inmunidadPromedio').value)
                .replace(/{{INCIDENTES}}/g, incidentesHTML)
                .replace(/{{PATRON_CONFIRMADO}}/g, document.getElementById('patronConfirmado').value)
                .replace(/{{DARK_WEB_INTEL}}/g, darkWebSection);
            
            // Mostrar preview
            setTimeout(() => {
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('outputSection').style.display = 'block';
                
                const iframe = document.getElementById('previewFrame');
                const doc = iframe.contentDocument || iframe.contentWindow.document;
                doc.open();
                doc.write(finalHTML);
                doc.close();
                
                // Guardar HTML para descarga
                window.generatedHTML = finalHTML;
            }, 1500);
        }
        
        // Funci√≥n para descargar el reporte
        function downloadReport() {
            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;
            const filename = `immunity-dashboard-${fechaFin}.html`;
            
            const blob = new Blob([window.generatedHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Agregar incidentes y amenazas iniciales
        window.onload = function() {
            // Agregar 3 incidentes de ejemplo
            for (let i = 0; i < 3; i++) {
                addIncident();
            }
            
            // Agregar 3 grupos APT de ejemplo
            for (let i = 0; i < 3; i++) {
                addThreatActor();
            }
        };
    </script>
</body>
</html>